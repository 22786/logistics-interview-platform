<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1209329 Logistics Customer Discovery</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f4f7f6; max-width: 900px; margin: auto; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #004494; text-align: center; }
        .instruction-box { background-color: #f0f7ff; border-left: 6px solid #0056b3; padding: 15px; margin-bottom: 20px; font-size: 0.9em; }
        .student-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        #chat-box { border: 1px solid #eee; height: 350px; overflow-y: auto; padding: 15px; margin: 20px 0; background: #fafafa; border-radius: 8px; }
        .msg-line { margin-bottom: 10px; }
        .student-tag { color: #0056b3; font-weight: bold; }
        .persona-tag { color: #2e7d32; font-weight: bold; }
        .system-tag { color: #d32f2f; font-weight: bold; }
        button { background: #004494; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; }
        button:hover { background: #003366; }
    </style>
</head>
<body>

<div class="container">
    <h2>Logistics Workshop: Customer Discovery</h2>
    
    <div class="instruction-box">
        <b>üìå English Only:</b> Customers don't speak Thai. | <b>Goal:</b> Find the Root Cause.
    </div>

    <div class="student-info-grid">
        <input type="text" id="studentName" placeholder="Full Name (‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)">
        <input type="text" id="studentId" placeholder="Student ID (‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤)">
    </div>

    <div style="margin-bottom: 15px;">
        <label><b>Target Interviewee:</b></label>
        <select id="role">
            <option value="somchai_retailer">Mr. Somchai (Traditional Retail)</option>
            <option value="vina_shipper">Ms. Vina (Warehouse)</option>
            <option value="lisa_startup">Lisa (Tech Founder)</option>
            <option value="bruno_driver">Bruno (Truck Driver)</option>
            <option value="marbel_forwarder">Marbel (Freight Forwarder)</option>
            <option value="ed_procurement">Ed (Factory Manager)</option>
            <option value="billie_seller">Billie (E-commerce)</option>
        </select>
    </div>

    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border: 1px solid #90caf9; margin-bottom: 15px;">
        <label><b>üîë Groq API Key:</b></label>
        <input type="password" id="apiKeyInput" placeholder="gsk_xxxxxxxxxxxx">
    </div>

    <div id="chat-box">
        <div class="msg-line"><span class="system-tag">System:</span> Please enter info and start your interview.</div>
    </div>

    <textarea id="userInput" placeholder="Type your question in English..."></textarea>
    <button onclick="sendMessage()" id="sendBtn">Send / ‡∏™‡πà‡∏á</button>
</div>

<script>
    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ) ---
    function appendMessage(sender, text) {
        const chatBox = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = 'msg-line';
        
        let tagClass = 'system-tag';
        if (sender === 'You') tagClass = 'student-tag';
        if (sender === 'AI') tagClass = 'persona-tag';

        div.innerHTML = `<span class="${tagClass}">${sender}:</span> ${text}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
        const inputField = document.getElementById('userInput');
        const message = inputField.value.trim();
        const apiKey = document.getElementById('apiKeyInput').value.trim();
        const studentName = document.getElementById('studentName').value.trim();
        const studentId = document.getElementById('studentId').value.trim();
        const role = document.getElementById('role').value; // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ID ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô

        if (!apiKey) { alert("Please enter API Key!"); return; }
        if (!studentName || !studentId) { alert("Please enter your Name and ID!"); return; }
        if (!message) return;

        appendMessage('You', message);
        inputField.value = '';
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'loading';
        loadingDiv.innerHTML = '<i>Thinking...</i>';
        document.getElementById('chat-box').appendChild(loadingDiv);

        try {
            const response = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message, role, studentName, studentId, apiKey })
            });

            const data = await response.json();
            document.getElementById('loading').remove();

            if (response.ok) {
                appendMessage('AI', data.text);
            } else {
                appendMessage('System', data.text);
            }
        } catch (error) {
            if(document.getElementById('loading')) document.getElementById('loading').remove();
            appendMessage('System', '‚ùå Connection Error.');
        }
    }

    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î Enter
    document.getElementById('userInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
</script>
</body>
</html>